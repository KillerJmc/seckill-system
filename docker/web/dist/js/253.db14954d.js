"use strict";(self["webpackChunkseckill_system_web"]=self["webpackChunkseckill_system_web"]||[]).push([[253],{253:function(e,t,n){n.r(t),n.d(t,{default:function(){return P}});var o=n(311);const i=e=>((0,o.pushScopeId)("data-v-5ad16238"),e=e(),(0,o.popScopeId)(),e),a={class:"header"},r=i((()=>(0,o.createElementVNode)("div",{class:"left-block"},null,-1))),s=i((()=>(0,o.createElementVNode)("div",{class:"title"},[(0,o.createElementVNode)("p",null,"Lingyuangou")],-1))),c=i((()=>(0,o.createElementVNode)("div",{class:"right-block"},null,-1))),l={class:"account-bar"},d=i((()=>(0,o.createElementVNode)("div",{class:"account-info"},null,-1))),u={class:"account-name"},m={class:"content"},h={key:0,class:"seckill-form"},p={class:"information"},v=i((()=>(0,o.createElementVNode)("br",null,null,-1))),w=i((()=>(0,o.createElementVNode)("br",null,null,-1))),E={class:"time"},k=(0,o.createTextVNode)(" 活动倒计时: "),y={class:"button-view"},g={key:1,class:"seckill-success-form"},S=i((()=>(0,o.createElementVNode)("div",{class:"order-info-title"},"订单信息",-1))),N={class:"order-info"},f=i((()=>(0,o.createElementVNode)("br",null,null,-1))),V={class:"button-view"};function D(e,t,n,i,D,C){const b=(0,o.resolveComponent)("count-down");return(0,o.openBlock)(),(0,o.createElementBlock)("div",null,[(0,o.createElementVNode)("div",a,[r,s,c,(0,o.createElementVNode)("div",l,[d,(0,o.createElementVNode)("div",u,(0,o.toDisplayString)(e.customer.name),1),(0,o.createElementVNode)("div",{class:"log-out",onClick:t[0]||(t[0]=(...e)=>C.logOut&&C.logOut(...e))},"退出登录")])]),(0,o.createElementVNode)("div",m,[e.gotoOrderPage?(0,o.createCommentVNode)("",!0):((0,o.openBlock)(),(0,o.createElementBlock)("div",h,[(0,o.createElementVNode)("div",p,[(0,o.createTextVNode)((0,o.toDisplayString)(e.activity.product.name)+" ",1),v,w,(0,o.createTextVNode)(" 库存总量："+(0,o.toDisplayString)(e.activity.amount)+"份 ",1)]),(0,o.createElementVNode)("div",E,[k,e.countDown.display?((0,o.openBlock)(),(0,o.createBlock)(b,{key:0,"remain-time":e.countDown.remainSeconds,onCountDownEnd:C.countDownEnd},null,8,["remain-time","onCountDownEnd"])):(0,o.createCommentVNode)("",!0)]),(0,o.createElementVNode)("div",y,[(0,o.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>C.seckillButton&&C.seckillButton(...e)),class:(0,o.normalizeClass)({"enter-button":!0,disabled:!C.enableSeckillButton})},"秒杀",2)])])),e.gotoOrderPage?((0,o.openBlock)(),(0,o.createElementBlock)("div",g,[S,(0,o.createElementVNode)("div",N,[(0,o.createTextVNode)(" 订单编号："+(0,o.toDisplayString)(e.order.orderId),1),f,(0,o.createTextVNode)(" 订单金额："+(0,o.toDisplayString)(e.order.money)+"元 ",1)]),(0,o.createElementVNode)("div",V,[(0,o.createElementVNode)("button",{onClick:t[2]||(t[2]=(...e)=>C.payOrderButton&&C.payOrderButton(...e)),class:"enter-button"},"付款")])])):(0,o.createCommentVNode)("",!0)])])}var C=n(163);function b(e,t,n,i,a,r){return(0,o.openBlock)(),(0,o.createElementBlock)("span",null,(0,o.toDisplayString)(r.hourString+":"+r.minuteString+":"+r.secondString),1)}var B={name:"CountDown",data(){return{hour:"",minute:"",second:"",timer:""}},props:{remainTime:{default:""}},mounted(){if(this.remainTime>0)return this.hour=Math.floor(this.remainTime/3600),this.minute=Math.floor(this.remainTime/60%60),this.second=Math.floor(this.remainTime%60),void this.countDown();this.$emit("count-down-end")},methods:{countDown(){let e=this;clearInterval(this.timer),this.timer=setInterval((function(){0===e.hour?0!==e.minute&&0===e.second?(e.second=59,e.minute-=1):0===e.minute&&0===e.second?(e.second=0,e.$emit("count-down-end"),clearInterval(e.timer)):e.second-=1:0!==e.minute&&0===e.second?(e.second=59,e.minute-=1):0===e.minute&&0===e.second?(e.hour-=1,e.minute=59,e.second=59):e.second-=1}),1e3)},formatNum(e){return e<10?"0"+e:""+e}},computed:{hourString(){return this.formatNum(this.hour)},minuteString(){return this.formatNum(this.minute)},secondString(){return this.formatNum(this.second)}}},I=n(89);const T=(0,I.Z)(B,[["render",b]]);var O=T,$=n(442),_={name:"Seckill",components:{CountDown:O},data:()=>({customer:{name:"",applied:!1},activity:{startTime:"",product:{name:"",info:""},amount:0},countDown:{display:!1,remainSeconds:0,end:!1},seckillUrl:"",gotoOrderPage:!1,order:{orderId:"",money:0}}),async mounted(){await this.init()},methods:{async init(){$.W.verify()||await this.$router.push("/");let e=await this.$store.dispatch("customer/getInfo"),t=await this.$store.dispatch("activity/getCurrent");if(200===e.code&&200===t.code||await this.$router.push("/"),this.customer=e.data,this.activity=t.data,!this.customer.applied)return console.warn("用户未申请活动！"),void await this.$router.push("/apply");this.countDown.remainSeconds=(await this.$store.dispatch("activity/getCountDown")).data,this.countDown.display=!0;let n=this,o=setInterval((async()=>{if(this.countDown.end){let e=await this.$store.dispatch("activity/getSeckillUrl");200===e.code&&(n.seckillUrl=e.data,console.log("获取到秒杀链接："+n.seckillUrl),clearInterval(o))}}),1e3)},async seckillButton(){if(!this.enableSeckillButton)return void await alert(C.Z.SECKILL_NOT_STARTED);let e=await this.$store.dispatch("activity/seckill",this.seckillUrl);if(500===e.code&&e.message!==C.Z.PURCHASE_REPEAT)return;200===e.code&&await alert(C.Z.SECKILL_SUCCESS);let t=await this.$store.dispatch("activity/getOrder");if(500===t.code)return;const{putOrderSuccess:n}=t.data;n?(this.order=t.data,this.gotoOrderPage=!0):await alert(C.Z.PUT_ORDER_FAILED)},async payOrderButton(){let e=await this.$store.dispatch("activity/pay",{orderId:this.order.orderId});if(500===e.code)return;const{paymentSuccess:t}=e.data;await alert(t?C.Z.PURCHASE_SUCCESS:C.Z.PURCHASE_FAILED)},countDownEnd(){this.countDown.end=!0},logOut(){this.$store.dispatch("settings/logout"),this.$router.push("/")}},computed:{enableSeckillButton(){return""!==this.seckillUrl&&this.countDown.end}}};const U=(0,I.Z)(_,[["render",D],["__scopeId","data-v-5ad16238"]]);var P=U}}]);
//# sourceMappingURL=253.db14954d.js.map