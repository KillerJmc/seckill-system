{"version":3,"file":"js/768.a4ca7b56.js","mappings":"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","sources":["webpack://seckill-system-web/./src/views/Seckill.vue","webpack://seckill-system-web/./src/components/CountDown.vue","webpack://seckill-system-web/./src/components/CountDown.vue?0a19","webpack://seckill-system-web/./src/views/Seckill.vue?2de3"],"sourcesContent":["<template>\r\n  <!-- UI作者：ChaconneLuo -->\r\n  <div>\r\n    <div class=\"header\">\r\n      <div class=\"left-block\"></div>\r\n      <div class=\"title\">\r\n        <p>Lingyuangou</p>\r\n      </div>\r\n      <div class=\"right-block\"></div>\r\n      <div class=\"account-bar\">\r\n        <div class=\"account-info\">\r\n        </div>\r\n        <div class=\"account-name\">{{ customer.name }}</div>\r\n        <div class=\"log-out\" @click=\"logOut\">退出登录</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"content\">\r\n      <div class=\"seckill-form\" v-if=\"!gotoOrderPage\">\r\n        <div class=\"information\">\r\n          {{ activity.product.name }} <br><br>\r\n          库存总量：{{ activity.amount }}份\r\n        </div>\r\n        <div class=\"time\">\r\n          活动倒计时:\r\n          <count-down v-if=\"countDown.display\" :remain-time=\"countDown.remainSeconds\" @count-down-end=\"countDownEnd\"/>\r\n        </div>\r\n        <div class=\"button-view\">\r\n          <button @click=\"seckillButton\" :class=\"{'enter-button': true, 'disabled': !enableSeckillButton}\">秒杀</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"seckill-success-form\" v-if=\"gotoOrderPage\">\r\n        <div class=\"order-info-title\">订单信息</div>\r\n        <div class=\"order-info\">\r\n          订单编号：{{ order.orderId }}<br>\r\n          订单金额：{{ order.money }}元\r\n        </div>\r\n        <div class=\"button-view\">\r\n          <button @click=\"payOrderButton\" class=\"enter-button\">付款</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport MsgMapping from \"@/const/msg-mapping\";\r\n\r\nimport CountDown from \"@/components/CountDown\";\r\nimport { Token } from \"@/auth/token\";\r\n\r\nexport default {\r\n  name: \"Seckill\",\r\n  components: {\r\n    // 倒计时组件\r\n    CountDown\r\n  },\r\n  data: () => {\r\n    return {\r\n      // 客户信息\r\n      customer: {\r\n        // 客户姓名\r\n        name: '',\r\n        // 是否申请过活动\r\n        applied: false,\r\n      },\r\n\r\n      // 活动信息\r\n      activity: {\r\n        // 开始时间\r\n        startTime: '',\r\n        // 商品信息\r\n        product: {\r\n          // 商品名称\r\n          name: '',\r\n          // 商品介绍\r\n          info: '',\r\n        },\r\n        // 库存总量\r\n        amount: 0\r\n      },\r\n\r\n      // 秒杀倒计时\r\n      countDown: {\r\n        // 是否显示\r\n        display: false,\r\n        // 剩余时间（秒）\r\n        remainSeconds: 0,\r\n        // 是否结束\r\n        end: false\r\n      },\r\n\r\n      // 秒杀链接\r\n      seckillUrl: '',\r\n\r\n      // 是否前往订单页面\r\n      gotoOrderPage: false,\r\n\r\n      // 订单信息\r\n      order: {\r\n        // 订单id\r\n        orderId: '',\r\n        // 订单价格\r\n        money: 0\r\n      }\r\n    }\r\n  },\r\n  async mounted() {\r\n    await this.init()\r\n  },\r\n  methods: {\r\n    async init() {\r\n      // 如果没有token就跳转登录\r\n      if (!Token.verify()) {\r\n        await this.$router.push('/');\r\n      }\r\n\r\n      // 请求客户信息\r\n      let customerInfo = await this.$store.dispatch('customer/getInfo')\r\n\r\n      // 请求当前秒杀活动信息\r\n      let activityInfo = await this.$store.dispatch('activity/getCurrent')\r\n\r\n      // 如果请求失败就返回主页\r\n      if (customerInfo.code !== 200 || activityInfo.code !== 200) {\r\n        await this.$router.push('/');\r\n      }\r\n\r\n      // 填充客户信息\r\n      this.customer = customerInfo.data\r\n\r\n      // 填充秒杀活动信息\r\n      this.activity = activityInfo.data\r\n\r\n      // 如果没有申请活动就返回申请页面\r\n      if (!this.customer.applied) {\r\n        console.warn('用户未申请活动！')\r\n        await this.$router.push('/apply')\r\n        return\r\n      }\r\n\r\n      // end\r\n\r\n      // 获得倒计时秒数并初始化倒计时组件\r\n      this.countDown.remainSeconds = (await this.$store.dispatch('activity/getCountDown')).data\r\n      // 展示倒计时\r\n      this.countDown.display = true\r\n\r\n      // 倒计时结束后每秒获取一次秒杀链接，获取到之后使按钮亮起开启秒杀\r\n      let self = this\r\n      let enableSeckillButtonLoop = setInterval(async () => {\r\n        if (this.countDown.end) {\r\n          let res = await this.$store.dispatch('activity/getSeckillUrl')\r\n          if (res.code === 200) {\r\n            self.seckillUrl = res.data\r\n            console.log('获取到秒杀链接：' + self.seckillUrl)\r\n            clearInterval(enableSeckillButtonLoop)\r\n          }\r\n        }\r\n      }, 1000)\r\n    },\r\n\r\n    async seckillButton() {\r\n      // 秒杀按钮未开启就提示信息\r\n      if (!this.enableSeckillButton) {\r\n        await alert(MsgMapping.SECKILL_NOT_STARTED)\r\n        return\r\n      }\r\n\r\n      // 尝试秒杀\r\n      let seckillRes = await this.$store.dispatch('activity/seckill', this.seckillUrl)\r\n\r\n      // 如果请求失败且不是重复购买的错误就返回\r\n      if (seckillRes.code === 500 && seckillRes.message !== MsgMapping.PURCHASE_REPEAT) {\r\n        return\r\n      }\r\n\r\n      // 如果请求成功就打印成功信息\r\n      if (seckillRes.code === 200) {\r\n        await alert(MsgMapping.SECKILL_SUCCESS)\r\n      }\r\n\r\n      // 获取订单\r\n      let orderData = await this.$store.dispatch('activity/getOrder')\r\n\r\n      // 获取失败就结束\r\n      if (orderData.code === 500) {\r\n        return\r\n      }\r\n\r\n      // 检查是否下订单失败\r\n      const { putOrderSuccess } = orderData.data\r\n      if (!putOrderSuccess) {\r\n        await alert(MsgMapping.PUT_ORDER_FAILED)\r\n        return\r\n      }\r\n\r\n      // 展示订单信息\r\n      this.order = orderData.data\r\n\r\n      // 前往订单页面\r\n      this.gotoOrderPage = true\r\n    },\r\n\r\n    // 支付订单按钮\r\n    async payOrderButton() {\r\n      // 发送支付请求\r\n      let paymentStatusData = await this.$store.dispatch('activity/pay', { orderId: this.order.orderId })\r\n\r\n      // 如果支付失败就返回\r\n      if (paymentStatusData.code === 500) {\r\n        return\r\n      }\r\n\r\n      // 判断是否支付成功\r\n      const { paymentSuccess } = paymentStatusData.data\r\n      // 显示支付结果\r\n      await alert(paymentSuccess ? MsgMapping.PURCHASE_SUCCESS : MsgMapping.PURCHASE_FAILED)\r\n    },\r\n\r\n    // 倒计时结束\r\n    countDownEnd() {\r\n      this.countDown.end = true\r\n    },\r\n\r\n    // 退出登录\r\n    logOut() {\r\n      this.$store.dispatch(\"settings/logout\")\r\n      this.$router.push(\"/\")\r\n    }\r\n  },\r\n  computed: {\r\n    // 是否开启秒杀按钮\r\n    enableSeckillButton() {\r\n      // 开启秒杀按钮的条件是客户已经得到秒杀id且倒计时结束\r\n      return this.seckillUrl !== '' && this.countDown.end\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style src=\"../assets/css/seckill.css\" scoped/>\r\n\r\n","<template>\r\n  <span>{{hourString+':'+minuteString+':'+secondString}}</span>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"CountDown\",\r\n  data () {\r\n    return {\r\n      hour: '',\r\n      minute: '',\r\n      second: '',\r\n      timer: ''\r\n    }\r\n  },\r\n  props: {\r\n    // 倒计时间总秒数\r\n    remainTime: {\r\n      default: ''\r\n    }\r\n  },\r\n  mounted () {\r\n    if (this.remainTime > 0) {\r\n      this.hour = Math.floor(this.remainTime / 3600)\r\n      this.minute = Math.floor((this.remainTime / 60) % 60)\r\n      this.second = Math.floor(this.remainTime % 60)\r\n      this.countDown()\r\n      return\r\n    }\r\n    // 发送倒计时结束信号\r\n    this.$emit(\"count-down-end\")\r\n  },\r\n  methods: {\r\n    countDown () {\r\n      let self = this\r\n      clearInterval(this.timer)\r\n      this.timer = setInterval(function () {\r\n        if (self.hour === 0) {\r\n          if (self.minute !== 0 && self.second === 0) {\r\n            self.second = 59\r\n            self.minute -= 1\r\n          } else if (self.minute === 0 && self.second === 0) {\r\n            self.second = 0\r\n            // 发送倒计时结束信号\r\n            self.$emit(\"count-down-end\")\r\n            clearInterval(self.timer)\r\n          } else {\r\n            self.second -= 1\r\n          }\r\n        } else {\r\n          if (self.minute !== 0 && self.second === 0) {\r\n            self.second = 59\r\n            self.minute -= 1\r\n          } else if (self.minute === 0 && self.second === 0) {\r\n            self.hour -= 1\r\n            self.minute = 59\r\n            self.second = 59\r\n          } else {\r\n            self.second -= 1\r\n          }\r\n        }\r\n      }, 1000)\r\n    },\r\n    formatNum (num) {\r\n      return num < 10 ? '0' + num : '' + num\r\n    }\r\n  },\r\n  computed: {\r\n    hourString () {\r\n      return this.formatNum(this.hour)\r\n    },\r\n    minuteString () {\r\n      return this.formatNum(this.minute)\r\n    },\r\n    secondString () {\r\n      return this.formatNum(this.second)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n","import { render } from \"./CountDown.vue?vue&type=template&id=32bd1e93\"\nimport script from \"./CountDown.vue?vue&type=script&lang=js\"\nexport * from \"./CountDown.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"D:\\\\Projects\\\\IdeaProjects\\\\seckill-system-web\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./Seckill.vue?vue&type=template&id=7d42bd86&scoped=true\"\nimport script from \"./Seckill.vue?vue&type=script&lang=js\"\nexport * from \"./Seckill.vue?vue&type=script&lang=js\"\n\nimport \"../assets/css/seckill.css?vue&type=style&index=0&id=7d42bd86&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\Projects\\\\IdeaProjects\\\\seckill-system-web\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-7d42bd86\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","_createElementBlock","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_6","_toDisplayString","_ctx","name","onClick","$options","product","_hoisted_11","_hoisted_12","amount","display","_createBlock","_component_count_down","remainSeconds","onCountDownEnd","_hoisted_17","orderId","_hoisted_19","money","data","hour","minute","second","timer","props","remainTime","default","mounted","this","Math","floor","countDown","$emit","methods","self","clearInterval","setInterval","formatNum","num","computed","hourString","minuteString","secondString","__exports__","components","CountDown","customer","applied","activity","startTime","info","end","seckillUrl","gotoOrderPage","order","async","init","Token","$router","push","customerInfo","$store","dispatch","activityInfo","code","console","warn","enableSeckillButtonLoop","res","log","enableSeckillButton","alert","MsgMapping","seckillRes","message","orderData","putOrderSuccess","paymentStatusData","paymentSuccess","countDownEnd","logOut","render"],"sourceRoot":""}