var C=Object.defineProperty;var A=(u,t,r)=>t in u?C(u,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[t]=r;var i=(u,t,r)=>(A(u,typeof t!="symbol"?t+"":t,r),r);import{defineStore as o}from"https://esm.sh/pinia@^2.0.23";import F from"https://esm.sh/js-cookie@^3.0.1";import p from"https://esm.sh/axios@^1.1.2";import{sha256 as g}from"https://esm.run/js-sha256@^0.9.0";const B={ACCOUNT_PWD_NULL_OR_EMPTY:"\u8D26\u53F7\u6216\u5BC6\u7801\u4E3A\u7A7A",INVALID_ACCOUNT:"\u8D26\u53F7\u4E0D\u5408\u6CD5",ACCOUNT_OR_PWD_ERROR:"\u8D26\u53F7\u6216\u5BC6\u7801\u9519\u8BEF",LOGIN_SUCCESS:"\u767B\u5F55\u6210\u529F",NAME_ID_NUM_PWD_NULL_OR_EMPTY:"\u59D3\u540D\uFF0C\u8EAB\u4EFD\u8BC1\u6216\u5BC6\u7801\u4E3A\u7A7A",ENTER_TWICE_PWD_MISMATCH:"\u4E24\u6B21\u8F93\u5165\u7684\u5BC6\u7801\u4E0D\u5339\u914D\uFF01",ID_NUM_REPEATED:"\u8EAB\u4EFD\u8BC1\u53F7\u91CD\u590D",REG_SUCCESS:"\u6CE8\u518C\u6210\u529F",ID_NUM_FORMAT_ERROR:"\u8EAB\u4EFD\u8BC1\u53F7\u683C\u5F0F\u9519\u8BEF",LOGIN_REPEAT:"\u91CD\u590D\u767B\u5F55",NOT_LOGGED_ON:"\u60A8\u8FD8\u672A\u767B\u5F55",APPLY_SUCCESS:"\u7533\u8BF7\u6210\u529F",APPLY_FAILED:"\u7533\u8BF7\u5931\u8D25\uFF0C\u60A8\u4E0D\u7B26\u5408\u7533\u8BF7\u6761\u4EF6",APPLY_REPEAT:"\u91CD\u590D\u7533\u8BF7",DOES_NOT_APPLY:"\u6CA1\u6709\u7533\u8BF7\u6D3B\u52A8",SECKILL_NOT_STARTED:"\u79D2\u6740\u6D3B\u52A8\u8FD8\u672A\u5F00\u59CB",SECKILL_ENDED:"\u79D2\u6740\u6D3B\u52A8\u5DF2\u7ECF\u7ED3\u675F",PRODUCT_SOLD_OUT:"\u5546\u54C1\u5DF2\u7ECF\u552E\u5B8C",PURCHASE_REPEAT:"\u91CD\u590D\u8D2D\u4E70",INVALID_SECKILL_URL:"\u79D2\u6740\u94FE\u63A5\u9519\u8BEF",SECKILL_SUCCESS:"\u79D2\u6740\u6210\u529F\uFF0C\u6B63\u5728\u83B7\u53D6\u8BA2\u5355",PUT_ORDER_FAILED:"\u4E0B\u8BA2\u5355\u5931\u8D25",PURCHASE_SUCCESS:"\u652F\u4ED8\u6210\u529F\uFF0C\u5DF2\u4ECE\u60A8\u7684\u9ED8\u8BA4\u8D26\u53F7\u4E2D\u6263\u6B3E\uFF01",PURCHASE_FAILED:"\u652F\u4ED8\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u652F\u4ED8\uFF01"},e=p.create({timeout:1e4,withCredentials:!0,baseURL:"http://localhost:9000"});e.interceptors.request.use(u=>u);e.interceptors.response.use(u=>{const t=u.data;return"code"in t&&"data"in t&&"message"in t?(t.code===500&&console.error(t.message),t):(console.error("\u8BF7\u6C42\u8FD4\u56DE\u503C\u7C7B\u578B\u9519\u8BEF\uFF01"),null)},u=>{console.error(u)});class a{static loginByAccount(t){return e.post("/customer/login",{account:t.account,password:t.password})}static loginByIdNumber(t){return e.post("/customer/login",{idNumber:t.idNumber,password:t.password})}static register(t){return e.post("/customer/register",t)}static logout(){return e.post("/customer/logout")}static getInfo(){return e.get("/customer/getInfo")}}class n{static hash(t){return g(t)}}class c{static validAccount(t){return c.isNum(t)||c.validIdNum(t)}static validIdNum(t){return(t==null?void 0:t.length)===18&&c.isNum(t)||/^\d+$/.test(t==null?void 0:t.substring(0,17))&&/^[A-Za-z]+$/.test(t==null?void 0:t.charAt(17))}static isNum(t){return/^\d+$/.test(t)}}const E=o("customer",{state:()=>({name:"",canApply:!1,applied:!1}),actions:{clearAll(){this.name="",this.canApply=!1,this.applied=!1,console.warn("customer: clear store!")},login(u){const{accountOrIdNumber:t}=u;return u.password=n.hash(u.password),c.validIdNum(t)?(u.idNumber=t,a.loginByIdNumber(u)):(u.account=Number.parseInt(t),a.loginByAccount(u))},register(u){return u.password=n.hash(u.password),a.register(u)},logout(){return a.logout()},async getInfo(){if(this.name!=="")return console.log("customer: get from cache!"),{code:200,data:this.$state};const u=await a.getInfo();return u.code===200&&(this.$state=u.data),u}}});class D{}i(D,"TOKEN_NAME","token");class _{static get(){return F.get(D.TOKEN_NAME)}}class s{static getCurrent(){return e.get("/seckillActivity/getCurrent")}static apply(){return e.post("/seckillActivity/apply")}static getCountDown(){return e.get("/seckillActivity/getCountDown")}static getSeckillUrl(){return e.get("/seckillActivity/getSeckillUrl")}static seckill(t){return e.post("/seckillActivity/seckill/"+t)}static getOrder(){return e.get("/seckillActivity/getOrder")}static pay(t){return e.post("/seckillActivity/pay","orderId="+t)}}const y=E(),S=o("activity",{state:()=>({activity:{}}),actions:{clearAll(){this.activity={},console.warn("apply: clear store!")},async getCurrent(){if(Object.keys(this.activity).length)return console.log("activity: get from cache!"),{code:200,data:this.activity};const u=await s.getCurrent();return u.code===200&&(this.activity=u.data),u},async apply(){const u=await s.apply();return(u.code===200||u.message===B.APPLY_REPEAT)&&(y.applied=!0,console.log("apply: update cache (customer.applied -> true)")),u},getCountDown(){return s.getCountDown()},getSeckillUrl(){return s.getSeckillUrl()},seckill(u){return s.seckill(u)},getOrder(){return s.getOrder()},pay(u){return s.pay(u)}}}),d=S(),l=E(),R=o("settings",{actions:{async logout(){await l.logout(),d.clearAll(),l.clearAll()},verifyLogin(){return!!_.get()}}});export{B as M,c as V,R as a,S as b,E as u};
